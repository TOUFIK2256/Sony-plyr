<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Sports</title>
    <!-- ফন্ট লোড করা হচ্ছে -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; }
        
        body {
            background-color: #0e0e0e; /* অ্যাপের ব্যাকগ্রাউন্ড কালো */
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 12px;
            color: white;
            user-select: none; /* টেক্সট কপি করা বন্ধ */
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 20px;
        }

        /* লোডিং টেক্সট ডিজাইন */
        #loader {
            text-align: center;
            color: #00e676;
            margin-top: 50%;
            font-size: 14px;
            font-weight: bold;
            display: block;
        }

        /* মেইন কার্ড ডিজাইন - গ্রিন বর্ডার সহ */
        .match-card {
            background-color: #1a1a1a;
            border: 1.5px solid #00e676; /* সেই নিয়ন গ্রিন বর্ডার */
            border-radius: 12px;
            padding: 12px 14px;
            margin-bottom: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: transform 0.2s;
        }

        .match-card:active {
            transform: scale(0.98); /* ক্লিক করলে একটু ছোট হবে */
            background-color: #222;
        }

        /* --- কার্ডের উপরের অংশ (Header) --- */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
            margin-bottom: 2px;
        }

        .league-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #eee;
            font-weight: 500;
        }

        .league-logo {
            width: 18px;
            height: 18px;
            object-fit: contain;
        }

        .match-timer-area {
            font-size: 11px;
            color: #bbb;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .timer-red {
            color: #ff3b30; /* লাল রঙের টাইমার */
            font-weight: bold;
            font-size: 13px;
            min-width: 40px;
            text-align: right;
            font-variant-numeric: tabular-nums; /* নাম্বারগুলো নড়বে না */
        }

        /* --- কার্ডের মাঝখানের অংশ (Teams) --- */
        .card-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 48px;
        }

        /* টিম সেকশন (বামে এবং ডানে) */
        .team-section {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1; /* সমান জায়গা নিবে */
            width: 0; /* টেক্সট ওভারফ্লো ফিক্স */
        }

        .team-left { justify-content: flex-start; }
        .team-right { justify-content: flex-end; }

        .team-name {
            font-weight: 700;
            font-size: 15px;
            color: #ffffff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; /* নাম বড় হলে ... দেখাবে */
        }

        .team-logo {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: contain;
            background-color: #252525;
            padding: 4px;
            flex-shrink: 0;
            border: 1px solid #333;
        }

        /* --- মাঝখানের লাইভ ইন্ডিকেটর --- */
        .live-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50px;
            flex-shrink: 0;
        }

        .live-dot {
            width: 7px;
            height: 7px;
            background-color: #ff3b30;
            border-radius: 50%;
            margin-bottom: 4px;
            box-shadow: 0 0 6px #ff3b30;
            animation: pulse 1.5s infinite;
        }

        .live-text {
            color: #ff3b30;
            font-size: 9px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .upcoming-text {
            color: #ff9800; /* হলুদ রঙ আপকামিং এর জন্য */
            font-size: 10px;
            font-weight: bold;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* এরর মেসেজ */
        .error-msg {
            color: #ff5252;
            text-align: center;
            margin-top: 50px;
            font-size: 13px;
            display: none;
        }

    </style>
</head>
<body>

    <div class="container" id="match-container">
        <div id="loader">Syncing Live Events...</div>
        <div id="error" class="error-msg">Failed to load data.</div>
    </div>

    <script>
        // তোমার দেওয়া লাইভ লিঙ্ক
        const API_URL = "https://psplay.site/lol/cric.php?ps=live-events";
        
        let matchesData = []; // ডাটা স্টোর করার ভেরিয়েবল

        // --- 1. ডেটা ফেচিং লজিক ---
        async function fetchLiveData() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Connection failed");
                
                const data = await response.json();
                matchesData = data; // নতুন ডেটা সেভ হলো
                
                // লোডার বন্ধ করে ডেটা রেন্ডার করা
                document.getElementById('loader').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                renderMatches();
                
            } catch (error) {
                console.error("Error:", error);
                // যদি প্রথমবার লোড করতে না পারে, এরর দেখাবে
                if(matchesData.length === 0) {
                    document.getElementById('loader').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').innerText = "Data Load Failed. Retrying...";
                }
            }
        }

        // --- 2. টাইম ক্যালকুলেশন লজিক ---
        function calculateStatus(startTimeStr) {
            if (!startTimeStr) return { time: "00:00", isLive: false, status: "Unknown" };

            // ডেট ফরম্যাট ঠিক করা (স্ল্যাশ থাকলে ড্যাশ দিয়ে রিপ্লেস)
            const formattedDate = startTimeStr.replace(/\//g, "-");
            const startTime = new Date(formattedDate);
            const now = new Date();

            const diffMs = now - startTime; // বর্তমান সময় থেকে শুরু বাদ

            // কন্ডিশন ১: খেলা এখনও শুরু হয়নি (Upcoming)
            if (diffMs < 0) {
                return { time: "Upcoming", isLive: false, status: "UP" };
            }
            
            // কন্ডিশন ২: খেলা অনেক আগে শেষ (২৪ ঘণ্টার বেশি)
            if (diffMs > 86400000) { 
                return { time: "Finished", isLive: false, status: "FT" };
            }

            // কন্ডিশন ৩: খেলা চলছে (Live Timer)
            const totalSeconds = Math.floor(diffMs / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            
            // সুন্দর ফরম্যাট (যেমন 05:09)
            const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            return { time: timeString, isLive: true, status: "LIVE" };
        }

        // --- 3. স্ক্রিনে দেখানোর লজিক (Render) ---
        function renderMatches() {
            const container = document.getElementById('match-container');
            // পুরো HTML ক্লিয়ার না করে শুধু আপডেট করা ভালো, তবে সিম্পল রাখার জন্য রিফ্রেশ করছি
            let htmlContent = '';

            // যদি কোনো ডেটা না থাকে
            if (matchesData.length === 0) return;

            matchesData.forEach(item => {
                const info = item.eventInfo;
                if (!info) return;

                const matchStatus = calculateStatus(info.startTime);
                
                // ইমেজ না থাকলে ডিফল্ট আইকন
                const defaultIcon = "https://cdn-icons-png.flaticon.com/512/16/16467.png"; 
                
                // লাইভ ডট দেখাবে কিনা
                let centerWidget = '';
                if (matchStatus.isLive) {
                    centerWidget = `
                        <div class="live-dot"></div>
                        <span class="live-text">LIVE</span>
                    `;
                } else if (matchStatus.status === "UP") {
                    centerWidget = `<span class="upcoming-text">VS</span>`;
                } else {
                    centerWidget = `<span class="live-text" style="color:#888">END</span>`;
                }

                // টাইমার কালার চেঞ্জ (লাইভ হলে লাল, না হলে হলুদ/সাদা)
                let timerColor = matchStatus.isLive ? '#ff3b30' : (matchStatus.status === "UP" ? '#ff9800' : '#888');

                htmlContent += `
                    <div class="match-card">
                        <!-- Header: League | Time -->
                        <div class="card-header">
                            <div class="league-info">
                                <img src="${info.eventLogo || defaultIcon}" class="league-logo" onerror="this.src='${defaultIcon}'">
                                <span>${info.eventCat} | ${info.eventType}</span>
                            </div>
                            <div class="match-timer-area">
                                ${matchStatus.status === 'UP' ? 'Starts In' : 'Match Started'} 
                                <span class="timer-red" style="color: ${timerColor}">${matchStatus.time}</span>
                            </div>
                        </div>

                        <!-- Body: Team A - Status - Team B -->
                        <div class="card-body">
                            <!-- Team A -->
                            <div class="team-section team-left">
                                <img src="${info.teamAFlag}" class="team-logo" onerror="this.src='${defaultIcon}'">
                                <span class="team-name">${info.teamA}</span>
                            </div>

                            <!-- Center Status -->
                            <div class="live-status">
                                ${centerWidget}
                            </div>

                            <!-- Team B -->
                            <div class="team-section team-right">
                                <span class="team-name" style="text-align: right;">${info.teamB}</span>
                                <img src="${info.teamBFlag}" class="team-logo" onerror="this.src='${defaultIcon}'">
                            </div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = htmlContent;
        }

        // --- সিস্টেম চালু ---
        
        // ১. প্রথমেই ডেটা আনবে
        fetchLiveData();

        // ২. টাইমার চালানোর জন্য প্রতি ১ সেকেন্ডে স্ক্রিন রিফ্রেশ হবে (ডেটা কল হবে না)
        setInterval(() => {
            if(matchesData.length > 0) renderMatches();
        }, 1000);

        // ৩. নতুন স্কোর বা ইভেন্ট আনার জন্য প্রতি ৩০ সেকেন্ডে সার্ভারে রিকোয়েস্ট পাঠাবে
        setInterval(fetchLiveData, 30000);

    </script>
</body>
</html>
